server:
  http_listen_port: 9009
  log_level: info
  graceful_shutdown_timeout: 30s

target: all
multitenancy_enabled: false

activity_tracker:
  filepath: /data/mimir-activity.log

# --- Ingesters (metric ingestion durability & replication) ---
ingester:
  wal:
    enabled: true
    dir: /data/wal
  lifecycler:
    ring:
      replication_factor: 3
      kvstore:
        store: inmemory
  max_transfer_retries: 0

# --- Blocks Storage (S3 backend) ---
blocks_storage:
  backend: s3
  storage_prefix: mimirblocks
  s3:
    bucket_name: ebs-monitoring-data
    endpoint: s3.us-west-2.amazonaws.com
    region: us-west-2
    # The correct, recognized parameter is placed here.
    s3_force_path_style: false
  tsdb:
    dir: /data/tsdb

# --- Ruler Storage (recording & alerting rules) ---
ruler_storage:
  backend: s3
  storage_prefix: mimiruler
  s3:
    bucket_name: ebs-monitoring-data
    endpoint: s3.us-west-2.amazonaws.com
    region: us-west-2
    # The correct, recognized parameter is placed here.
    s3_force_path_style: false

# --- Alertmanager Storage ---
alertmanager_storage:
  backend: s3
  s3:
    bucket_name: ebs-monitoring-data
    region: us-west-2
    endpoint: s3.us-west-2.amazonaws.com
    prefix: mimir/alertmanager/
    # The correct, recognized parameter is placed here.
    s3_force_path_style: false

# --- Compactor (retention & cleanup) ---
compactor:
  data_dir: /data/compactor
  sharding_enabled: true
  sharding_ring:
    kvstore:
      store: inmemory
  block_retention: 90d
  consistency_delay: 30m
  compaction_interval: 10m
  retention_enabled: true
  delete_request_cancel_period: 24h
  cleanup_interval: 1h

# --- Query Frontend (query caching & performance) ---
query_frontend:
  compress_responses: true
  log_queries_longer_than: 5s
  cache_results: true
  max_outstanding_per_tenant: 500

# --- Store Gateway (reading historical blocks from S3) ---
store_gateway:
  sharding_enabled: true
  sharding_ring:
    replication_factor: 1
    kvstore:
      store: inmemory
  backend: s3

# --- Limits (anti-overload safety nets) ---
limits:
  ingestion_rate: 20MB
  ingestion_burst_size: 40MB
  ingestion_tenant_shard_size: 1
  max_series_per_user: 500000
  max_samples_per_query: 5000000
  max_query_parallelism: 16
  compactor_blocks_retention_period: 90d
  accept_ha_samples: true

# --- Runtime Config (dynamic reloads without restart) ---
runtime_config:
  file: /etc/mimir/runtime-config.yaml
  reload_period: 10s

# --- Common (shared defaults across all components) ---
common:
  path_prefix: /data
  replication_factor: 3
  storage:
    backend: s3
    s3:
      bucket_name: ebs-monitoring-data
      region: us-west-2
      endpoint: s3.us-west-2.amazonaws.com
      signature_version: v4
