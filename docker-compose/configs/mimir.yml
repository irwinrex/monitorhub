server:
  http_listen_port: 9009
  log_level: info
  graceful_shutdown_timeout: 30s

target: all
multitenancy_enabled: false

activity_tracker:
  filepath: /data/mimir-activity.log

# --- Ingesters ---
ingester:
  wal:
    enabled: true
    dir: /data/wal
  lifecycler:
    ring:
      replication_factor: 3
      kvstore:
        store: inmemory
  max_transfer_retries: 0

# --- Blocks Storage (S3 backend) ---
blocks_storage:
  backend: s3
  storage_prefix: mimirblocks
  s3:
    bucket_name: ebs-monitoring-data
    endpoint: s3.us-west-2.amazonaws.com
    region: us-west-2
    # The correct parameter and location is inside http_config
    http_config:
      force_path_style: false
  tsdb:
    dir: /data/tsdb

# --- Ruler Storage (recording & alerting rules) ---
ruler_storage:
  backend: s3
  storage_prefix: mimiruler
  s3:
    bucket_name: ebs-monitoring-data
    endpoint: s3.us-west-2.amazonaws.com
    region: us-west-2
    # The correct parameter and location is inside http_config
    http_config:
      force_path_style: false

# --- Alertmanager Storage ---
alertmanager_storage:
  backend: s3
  s3:
    bucket_name: ebs-monitoring-data
    region: us-west-2
    endpoint: s3.us-west-2.amazonaws.com
    prefix: mimir/alertmanager/
    # The correct parameter and location is inside http_config
    http_config:
      force_path_style: false

# --- Compactor ---
compactor:
  data_dir: /data/compactor
  sharding_enabled: true
  sharding_ring:
    kvstore:
      store: inmemory
  block_retention: 90d

# --- Store Gateway ---
store_gateway:
  sharding_enabled: true
  sharding_ring:
    replication_factor: 1
    kvstore:
      store: inmemory

# --- Common (shared defaults across all components) ---
# We are defining storage specifically in each section, so a common
# storage block is not strictly necessary but can be kept for other defaults.
common:
  path_prefix: /data
  replication_factor: 3
