apiVersion: v1
kind: ConfigMap
metadata:
  name: tempo-config
  namespace: monitoring
data:
  tempo.yaml: |
    http_api_prefix: /tempo
    multitenancy_enabled: false

    server:
      http_listen_port: 3200
      grpc_listen_port: 9095

    distributor:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318

    ingester:
      trace_idle_period: 10s
      trace_live_period: 5m
      max_block_bytes: 524288000

    compactor:
      compaction:
        compaction_window: 1h
        block_retention: 2160h
        compacted_block_retention: 1h

    metrics_generator:
      enabled: false  # Explicitly disable to suppress warning

    storage:
      trace:
        backend: s3
        s3:
          bucket: ebs-monitoring-data
          endpoint: s3.us-west-2.amazonaws.com
          region: us-west-2
          prefix: tempo
        wal:
          path: /var/tempo/wal
          v2_encoding: snappy

    querier:
      max_concurrent_queries: 20

    query_frontend:
      max_cache_freshness_per_tenant: 1m
      search:
        max_duration: 2160h

    memberlist:
      node_name: tempo-single
      randomize_node_name: false
